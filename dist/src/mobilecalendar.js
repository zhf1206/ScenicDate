!function(t){var e,s,n=function(t){return s=t%100==0?t%400==0?1:0:t%4==0?1:0};Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var s in e)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[s]:("00"+e[s]).substr((""+e[s]).length)));return t};var a=function(s){this.settings={source:null,startdate:null,enddate:null,weekend:null,datetdCellClick:null},this.cheader="<table class='pCalendar'><tr class='cheader'><td class='theader'>周日</td><td class='theader'>周一</td><td class='theader'>周二</td><td class='theader'>周三</td><td class='theader'>周四</td><td class='theader'>周五</td><td class='theader'>周六</td></tr>",this.settings=t.extend(this.settings,s),e=this.settings,this.Init()};a.prototype={Init:function(){this.ctoday=new Date,this.cyear=this.ctoday.getFullYear(),this.daysNumPerMonth=new Array(31,28+n(this.cyear),31,30,31,30,31,31,30,31,30,31),this.cmonth=this.ctoday.getMonth(),this.tempMonth=this.cmonth,t(this.settings.source).html(""),this.drawCalendar(this.tempMonth),this.drawCalendar(++this.tempMonth),this.drawCalendar(++this.tempMonth),this.drawCalendar(++this.tempMonth),this.bindEvent()},BindPrice:function(){},addMonth:function(){this.drawCalendar(++this.tempMonth),this.bindEvent()},PrevMonth:function(){this.cmonth--,0==this.cmonth&&(this.cmonth=12,this.cyear--)},drawCalendar:function(e){var s=this.cyear;e>11&&(s+=Math.floor(e/12),e%=12);var n=null,a=null;if(null!=this.settings.startdate&&(n=new Date(this.settings.startdate.replace(/-/g,"/"))),null!=this.settings.enddate&&(a=new Date(this.settings.enddate.replace(/-/g,"/"))),!(null!=a&&new Date(s+"/"+(e+1)+"/01")>a)){for(var i,d,h=this.ctoday.getDate(),l=new Date(s,e,1),r=l.getDay(),c=this.daysNumPerMonth[e],o=Math.ceil((c+r)/7),u="",g=0;g<o;g++){u+="<tr>";for(var f=0;f<7;f++){i=7*g+f,d=i-r+1,d=d<=0||d>c?"":i-r+1;var v="",p="";if(""!=d){v=s+"-"+(e+1)+"-"+d,p="datetdCell ";var y=new Date(v.replace(/-/g,"/"));(null!=n&&y<n||null!=a&&y>a||null!=this.settings.weekend&&this.settings.weekend.indexOf(f)>=0)&&(p+="disabledtd ")}else p="emptyCell ";v=""!=v?new Date(v.replace(/-/g,"/")).format("yyyy-MM-dd"):"",u+=d==h&&e==this.cmonth&&s==this.cyear?"<td align='center' data-value='"+v+"' class='ctoday "+p+"'><div>"+d+"</div></td>":"<td align='center' data-value='"+v+"' class='"+p+"'><div>"+d+"</div></td>"}u+="</tr>"}u+="</table>";var m="<div class='Time-Div'>"+s+"年"+(e+1)+"月</div>";t(this.settings.source).append(m+this.cheader+u)}},bindEvent:function(){t(this.settings.source).find("td").unbind("click").click(function(){var s=t(this),n=s.attr("class");if(!(n.indexOf("theader")>=0||""==s.attr("data-value")||n.indexOf("disabledtd")>=0)){t(".selected").removeClass("selected"),s.addClass("selected");var a=s.attr("data-value");null!=e.datetdCellClick&&e.datetdCellClick(a)}}),t("#pmonth").click(function(){this.PrevMonth()}),t("#nmonth").click(function(){this.NextMonth()})},getSelectValue:function(){return t(this.settings.source).find(".selected").attr("data-value")},setStartDate:function(t){this.settings.startdate=t,this.Init()},setEndDate:function(t){this.settings.enddate=t,this.Init()},setDaysOfWeekDisabled:function(t){this.settings.weekend=t,this.Init()}},t.fn.extend({InitDailyPriceCalendar:function(e){e||(e={}),e.source=t(this);var s=new a(e);return s}})}(jQuery);